# 2025-11-28
-今日やったこと：タスクアプリにJSON機能とメニュー画面を追加した。一旦完成
-コード:
import json

class Task:


    def __init__(self,id,title,due_date,priority=2):
        self.id = id
        self.title = title
        self.due_date = due_date
        self.priority = priority
        self.is_done = False
    
    def complete(self):
        self.is_done = True

    def info(self):
        if self.is_done == True:
            status = '完了'
        else:
            status = '未完了'
        return f'[ID:{self.id}][{status}][優先度{self.priority}]{self.title} - {self.due_date}'
    
    def to_dict(self):
        return {
            "id": self.id,
            "title": self.title,
            "due_date": self.due_date,
            "priority": self.priority,
            "is_done": self.is_done
        }
    @classmethod
    def from_dict(cls,data):
        id = data['id']
        title = data['title']
        due_date = data['due_date']
        priority = data['priority']
        task = cls(id,title,due_date,priority)
        task.is_done = data.get('is_done',False)
        return task
     
    @staticmethod
    def sort_by_priority(tasks):
        def get_priority(task):
            return task.priority
        return sorted(tasks,key=get_priority)
      
class TaskManager:

    def __init__(self, filename="task.json"):
        self.task_list = []
        self.next_id = 1
        self.filename = filename

        self.load_from_json(self.filename)

    def add(self,task):
        self.task_list.append(task)
        print('タスクを追加しました。')
        self.save_to_json(self.filename)

    def add_auto(self,title,due_date,priority=2):
        task = Task(self.next_id,title,due_date,priority)
        self.next_id += 1
        self.task_list.append(task)
        print(f'タスクを追加しました。(ID={task.id})')
        self.save_to_json(self.filename)



    def list_tasks(self):
        if not self.task_list:
            print('タスクがありません。')
            return
        for task in self.task_list:
            print(task.info())
        
    def list_done_tasks(self):
        found=False
        for task in self.task_list:
            if task.is_done:
                print(task.info())
                found=True
        if not found:
            print('完了しているタスクがありません。')
        
    def list_undone_tasks(self):
        found=False
        for task in self.task_list:
            if not task.is_done:
                print(task.info())
                found = True
        if not found:
            print('未完了のタスクがありません。')



    def complete(self,task_id):
        for task in self.task_list:
            if task.id == task_id:
                task.complete()
                print('タスクを完了にしました。')
                self.save_to_json(self.filename)
                return
        print('そのタスクは見つかりませんでした。')


    def delete(self,task_id):
        for task in self.task_list:
            if task.id == task_id:
                self.task_list.remove(task)
                print('タスクを削除しました。')
                self.save_to_json(self.filename)
                return
        print('そのタスクは見つかりませんでした。')   
    

    def search(self,keyword):
        found = False
        for task in self.task_list:
            if keyword in task.title:
                print(task.info())
                found = True
    
        if not found:
            print('見つかりませんでした。')
#json保存    
    def save_to_json(self,filename):
        data = []
        for task in self.task_list:
            dict_data = task.to_dict()
            data.append(dict_data)
        
        with open(filename,"w",encoding="utf-8") as f:
            json.dump(data, f, ensure_ascii=False, indent=4)

        print("JSON に保存しました。")
#json読み込み
    def load_from_json(self,filename):
        try:
            with open(filename,"r", encoding="utf-8") as f:
                data = json.load(f)
            self.task_list = []

            for d in data:
                task = Task.from_dict(d)
                self.task_list.append(task)

            if self.task_list:
                max_id = 0
                for task in self.task_list:
                    if task.id > max_id:
                        max_id = task.id

                self.next_id = max_id + 1
            else:
                self.next_id = 1
            
            print("JSONから読み込みました。")
        
        except FileNotFoundError:
            print("ファイルがありません。初期状態で開始します。")
    


#メニュー表示用の関数
def show_menu():
    print("=== タスク管理アプリ ===")
    print("1. タスクを追加")
    print("2. タスクを一覧表示")
    print("3. 完了したタスクだけ表示")
    print("4. 未完了のタスクだけ表示")
    print("5. タスクを完了にする")
    print("6. タスクを削除する")
    print("0. 終了")
    print("=======================")

manager = TaskManager()

while True:
    show_menu()
    choice = input("番号を選んでください：")

    if choice == "1":
        title = input("タスクのタイトルを入力：")
        due_date = input("期限を入力：")
        priority_str = input("優先度を数字で入力 (1=高, 2=普通, 3=低)[Enterで2]:")

        if priority_str == "":
            priority = 2
        else:
            priority = int(priority_str)
        
        manager.add_auto(title,due_date,priority)
    
    elif choice == "2":
        manager.list_tasks()

    elif choice == "3":
        manager.list_done_tasks()

    elif choice == "4":
        manager.list_undone_tasks()
    
    elif choice == "5":
        task_id_str = input("完了したいタスクIDを入力：")
        if task_id_str.isdigit():
            task_id = int(task_id_str)
            manager.complete(task_id)
        else:
            print("数字で入力してください")
    
    elif choice =="6":
        task_id_str = input("削除したいタスクIDを入力:")
        if task_id_str.isdigit():
            task_id = int(task_id_str)
            manager.delete(task_id)
        else:
            print("数字で入力してください")
        
    elif choice == "0":
        print("終了します")
        break

    else:
        print("無効な数字です。0-6の数字を入力してください")







        
