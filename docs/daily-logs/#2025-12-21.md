# 2025-12-21

-今日やったこと：昨日作ったデートスポットを追加するアプリを追加、一覧まで機能を追加した。
-コード:

#app.py

from flask import Flask, render_template, request, redirect, url_for
import db


app = Flask(__name__)

db.create_date_spots_table()

@app.route("/list")
def index():
    spots = db.fetch_all_spots()
    return render_template("list.html", spots=spots)

@app.route("/add", methods=["GET","POST"])
def add():
    if request.method == "POST":

        name = request.form.get("name")
        area = request.form.get("area")
        category = request.form.get("category")
        url = request.form.get("url")
        memo = request.form.get("memo")

        if name == "":
            return render_template("add.html", error="場所名書かないと保存できないよぴょんりにゃん。")
        
        db.insert_spot(name, area, category, url, memo)

        return redirect(url_for("index"))
    
    return render_template("add.html")






if __name__ == "__main__":
    app.run(debug=True)

#db.py

import sqlite3

DATABASE = "database.db"

def create_books_table():

    con = sqlite3.connect(DATABASE)

    con.execute("""
                CREATE TABLE IF NOT EXISTS books (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                title TEXT,
                price INTEGER,
                arrival_day TEXT)
                """)
    
    con.commit()
    con.close()

def insert_book(title,price,arrival_day):

    con = sqlite3.connect(DATABASE)

    con.execute(
        "INSERT INTO books (title,price,arrival_day) VALUES (?,?,?)",
        (title, price, arrival_day)

    )

    con.commit()
    con.close()

def fetch_book(book_id):
    con = sqlite3.connect(DATABASE)
    cur = con.cursor()

    row = cur.execute(
        "SELECT id, title, price, arrival_day FROM books WHERE id = ?" ,
        (book_id,)
    ).fetchone()

    con.close()
    return row

def fetch_all_books():
    con = sqlite3.connect(DATABASE)
    cur = con.execute("SELECT id, title, price, arrival_day FROM books")
    rows = cur.fetchall()
    con.close()
    return rows

def update_book(book_id, title, price, arrival_day):
    con = sqlite3.connect(DATABASE)
    con.execute(
        "UPDATE books SET title = ?, price = ?, arrival_day = ? WHERE id = ?",
        (title, price, arrival_day, book_id)

    )
    con.commit()
    con.close()

def delete_book(book_id):
    con = sqlite3.connect(DATABASE)
    con.execute("DELETE FROM books WHERE id= ?", (book_id,))
    con.commit()
    con.close()


if __name__ == "__main__":
    create_books_table()

#list.html

<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>脱インドア</title>
    </head>
    <body>
        <h1>デートスポット一覧</h1>

        {% if spots %}
            <ul>
                {% for spot in spots %}
                    <li>
                        <strong>{{ spot["name"] }}</strong><br>
                        エリア：{{ spot["area"] }}<br>
                        カテゴリー：{{ spot["category"] }}<br>

                        {% if spot["url"] %}
                            <a href="{{ spot["url"] }}" target="_blank">リンク</a><br>
                        {% endif %}

                        メモ：{{ spot["memo"] }}<br>
                        状態：{{ spot["status"] }}                        
                    </li>
                    <hr>
                {% endfor %}                
            </ul>
        {% else %}
            <p>まだデートスポットはないよぱんりちゃん。</p>
        {% endif %}

        <p>
            <a href="/add">次に行きたい場所はここだ！</a>
        </p>

    </body>


</html>

#add.html

<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>いっぱいデートスポット追加してねん</title>
    </head>
    <body>
        <h1>デートスポット追加しまくってね</h1>

        {% if error %}
            <p style="color:red;">{{ error }}</p>
        {% endif %}

        <form action="/add" method="post">
            <p>
                スポット名（必須））<br>
                <input type="text" name="name">
            </p>
            <p>
                エリア (例:神戸・大阪)<br>
                <input type="text" name="area">       
            </p>
            <p>
                カテゴリー(例:カフェ・ご飯)<br>
                <input type="text" name="category">
            </p>
            <p>
                URL<br>
                <input type="text" name="url">                
            </p>
            <p>
                メモ<br>
                <textarea name="memo"></textarea>
            </p>
            <p>
                ステータス<br>
                <select name="status">
                    <option value="want">行きたい</option>
                    <option value="want">行った</option>
                    <option value="maybe">保留</option>
                </select>
            </p>
            <p>
                <button type="submit">追加する</button>
            </p>


        </form>
        <p>
            <a href="/list">一覧へ戻る</a>
        </p>
    </body>
</html>

