#2025-12-18
-今日やったこと：FLASKで削除機能を追加したり、更新機能を追加したりしたりデータベースへ保存もした。
-コード：

#app.py

from flask import Flask,render_template,request,redirect,url_for
import db

app = Flask(__name__)

@app.route("/")
def index():
    return render_template("form.html")

@app.route("/add", methods=["POST"])
def add():
    title = request.form["title"]
    price = int(request.form["price"])
    arrival_day = request.form["arrival_day"]

    db.insert_book(title,price,arrival_day)
    return redirect("/list")

@app.route("/list")
def list_books():
    books = db.fetch_all_books()
    return render_template("list.html", books=books)

@app.route("/edit/<int:book_id>")
def edit(book_id):
    book = db.fetch_book(book_id)
    return render_template("edit.html", book=book)

@app.route("/update/<int:book_id>", methods=["POST"])
def update(book_id):
    title = request.form["title"]
    price = request.form["price"]
    arrival_day = request.form["arrival_day"]

    db.update_book(book_id, title, price, arrival_day)
    return redirect("/list")

@app.route("/delete/<int:book_id>", methods=["POST"])
def delete(book_id):
    db.delete_book(book_id)
    return redirect("/list")

if __name__ == "__main__":
    app.run(debug=True)


# db.py

import sqlite3

DATABASE = "database.db"

def create_books_table():

    con = sqlite3.connect(DATABASE)

    con.execute("""
                CREATE TABLE IF NOT EXISTS books (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                title TEXT,
                price INTEGER,
                arrival_day TEXT)
                """)
    
    con.commit()
    con.close()

def insert_book(title,price,arrival_day):

    con = sqlite3.connect(DATABASE)

    con.execute(
        "INSERT INTO books (title,price,arrival_day) VALUES (?,?,?)",
        (title, price, arrival_day)

    )

    con.commit()
    con.close()

def fetch_book(book_id):
    con = sqlite3.connect(DATABASE)
    cur = con.cursor()

    row = cur.execute(
        "SELECT id, title, price, arrival_day FROM books WHERE id = ?" ,
        (book_id,)
    ).fetchone()

    con.close()
    return row

def fetch_all_books():
    con = sqlite3.connect(DATABASE)
    cur = con.execute("SELECT id, title, price, arrival_day FROM books")
    rows = cur.fetchall()
    con.close()
    return rows

def update_book(book_id, title, price, arrival_day):
    con = sqlite3.connect(DATABASE)
    con.execute(
        "UPDATE books SET title = ?, price = ?, arrival_day = ? WHERE id = ?",
        (title, price, arrival_day, book_id)

    )
    con.commit()
    con.close()

def delete_book(book_id):
    con = sqlite3.connect(DATABASE)
    con.execute("DELETE FROM books WHERE id= ?", (book_id,))
    con.commit()
    con.close()


if __name__ == "__main__":
    create_books_table()

# form.html

<!DOCTYPE html>

<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>本の登録</title>
    </head>
        <body>

            <h1>本の登録フォーム</h1>

            <form action="/add" method="post">
                <input type="text" name="title">
                <input type="number" name="price">
                <input type="text" name="arrival_day">

                <input type="submit" value="登録">


            </form>

            <p><a href="/list">一覧へ</a></p>
        </body>


</html>

# list.html

<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>一覧</title>
    </head>
    <body>
        <h1>登録された本の一覧</h1>

        {% if books %}

          <ul>
            {% for id, title, price, arrival_day in books %}
                <li>
                    [{{ id }}]
                    タイトル： {{ title }}
                    / 値段： {{ price }}
                    / 入荷日： {{arrival_day}}

                    <form action="/delete/{{ id }}" method="post" style="display:inline;">
                        <button type="submit">削除</button>
                        
                    </form>
                    <a href="/edit/{{ id }}">編集</a>
                </li>
            {% endfor %}
          </ul>
        {% else %}
            <p>まだ登録がありません。</p>
        {% endif %}

        <p><a href="/">フォームへ戻る</a></p>
    </body>
</html>

# edit.html

<!DOCTYPE html>

<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>本の編集</title>
    </head>
        <body>
            <h1>本を編集</h1>

            <form action="/update/{{ book[0] }}" method="post">
                <p>タイトル： <input type="text" name="title" value="{{ book[1] }}"></p>
                <p>値段： <input type="number" name="price" value="{{ book[2] }}"></p>
                <p>入荷日： <input type="text" name="arrival_day" value="{{ book[3] }}"></p>
                <input type="submit" value="更新">
            </form>

            <p><a href="/list">一覧へ戻る</a></p>
        </body>
</html>

    










