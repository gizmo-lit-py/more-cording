#2025-12-14
-今日やったこと:Flask + SQLiteで新刊情報を登録・一覧表示するWebアプリを実装した。まだまだ理解できてないからもっとする。
-コード:
#__init__.py

from flask import Flask

app = Flask(__name__)
from . import main

from flaskr import db

db.create_books_table()

#db.py

import sqlite3

DATABASE = 'database.db'

def create_books_table():
    con = sqlite3.connect(DATABASE)
    con.execute('CREATE TABLE IF NOT EXISTS books (title,price,arrival_day)')
    con.close()

#main.py

from . import app
from flask import render_template,request,redirect,url_for
import sqlite3
DATABASE = 'database.db'

@app.route('/')
def index():
    con = sqlite3.connect(DATABASE)
    db_books = con.execute('SELECT * FROM books').fetchall()
    con.close()

    books = []
    for row in db_books:
        books.append({'title': row[0],'price' :row[1],'arrival_day': row[2]})
    
    return render_template(
        'index.html',
        books=books
    )

@app.route('/form')
def form():
    return render_template(
        'form.html'
    )

@app.route('/register', methods=['POST'])
def register():
    title = request.form['title']
    price = request.form['price']
    arrival_day = request.form['arrival_day']

    con = sqlite3.connect(DATABASE)
    con.execute('INSERT INTRO books VALUE(?,?,?)',
               [title,price,arrival_day])
    con.commit()
    con.close()
    return redirect(url_for('index'))

#index.html

<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>サプーアプリ</title>
    </head>
    <body>
        <h1>サプー書店</h1>
        <h2>今月の新刊一覧</h2>
            {% if books == [] %}
                <p>今月の新刊情報はまだありません</p>
            {% else %}
                <table border="1">
                    <tr>
                        <th>入荷日</th>
                        <th>タイトル</th>
                        <th>金額</th>
                    </tr>
                    {% for book in books %}
                        <tr>
                            <td>{{book.arrival_day}}</td>
                            <td>{{book.title}}</td>
                            <td>{{book.price}}円</td>
                        </tr>
                    {% endfor %}
                </table>
            {% endif %}
        <a href="{{ url_for('form')}}">編集</a>  
    </body>
</html>

#form.html

<!DOCTYPE html>
<html lang ="ja">
    <head>
        <meta charset="UTF-8">
        <title>商品登録</title>
    </head>
    <body>

        <h1>サプー書店</h1>

        <form method="post" action="{{ url_for('register') }}">
            <table border="1">
                <tr>
                    <th>入荷日</th>
                    <th>タイトル</th>
                    <th>金額</th>
                </tr>
                <tr>
                    <td><input type="text" name="arrival_day"></td>
                    <td><input type="text" name="title"></td>
                    <td><input type="text" name="price"></td>
                </tr>
            </table>
            <br>
            <input type="submit" value="登録"           
        </form>
    </body>
</html>



